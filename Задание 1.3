/*
 ============================================================================
 Name        : 1.3
 Author      : 
 Version     :
 Copyright   : Your copyright notice
 Description : Hello World in C, Ansi-style
 ============================================================================
 */

#include <stdio.h>          // Подключаем библиотеку для работы с функциями ввода-вывода
#include <stdlib.h>         // Подключаем библиотеку для динамического выделения памяти и работы с файлами
#include <string.h>         // Подключаем библиотеку для работы со строками (strcmp, strcpy)

#define MAX_REGIONS 10      // Определяем константу для максимального количества регионов
#define MAX_NAME_LEN 100    // Определяем максимальную длину названия региона или культуры
#define MAX_CULTURES 5      // Определяем максимальное количество культур на регион

// Структура для описания культуры
typedef struct {
    char name[MAX_NAME_LEN];    // Название культуры (массив символов фиксированной длины)
    float yield;                // Объем урожая в год (вещественное число)
    float area;                 // Площадь засева культурой (в гектарах, вещественное число)
} Culture;                      // Имя структуры для культуры

// Основная структура "Сельское хозяйство"
typedef struct {
    char region[MAX_NAME_LEN];  // Название региона
    Culture cultures[MAX_CULTURES]; // Массив культур для данного региона
    int culture_count;          // Количество культур в регионе (для динамического подсчета)
} Agriculture;                  // Имя основной структуры

// Функция для вычисления суммарной площади засева по всем культурам региона
float get_total_area(Agriculture *reg) {
    float total = 0.0;          // Инициализируем переменную для суммирования площадей
    for (int i = 0; i < reg->culture_count; i++) {  // Проходим по всем культурам региона
        total += reg->cultures[i].area;             // Прибавляем площадь каждой культуры
    }
    return total;               // Возвращаем суммарную площадь
}

// Функция для вычисления суммарного объема урожая региона
float get_total_yield(Agriculture *reg) {
    float total = 0.0;          // Инициализируем переменную для суммирования урожая
    for (int i = 0; i < reg->culture_count; i++) {  // Проходим по всем культурам региона
        total += reg->cultures[i].yield;            // Прибавляем урожай каждой культуры
    }
    return total;               // Возвращаем суммарный урожай
}

// Функция сортировки пузырьком (замена qsort)
void bubble_sort(Agriculture *regions, int count) {
    int i, j;                   // Счетчики для внешнего и внутреннего циклов
    Agriculture temp;           // Временная переменная для обмена элементами

    // Внешний цикл - количество проходов (n-1)
    for (i = 0; i < count - 1; i++) {
        // Внутренний цикл - сравнение соседних элементов
        for (j = 0; j < count - i - 1; j++) {
            // Сравниваем регионы по общему объему урожая
            float yield1 = get_total_yield(&regions[j]);     // Урожай текущего региона
            float yield2 = get_total_yield(&regions[j + 1]); // Урожай следующего региона

            // Если текущий урожай больше следующего - меняем местами
            if (yield1 > yield2) {
                temp = regions[j];          // Копируем текущий регион во временную переменную
                regions[j] = regions[j + 1]; // Сдвигаем следующий регион на место текущего
                regions[j + 1] = temp;      // Помещаем текущий регион на место следующего
            }
        }
    }
}

int main() {
    Agriculture regions[MAX_REGIONS];   // Создаем массив из 10 структур регионов
    FILE *file;                         // Указатель на файл для чтения данных
    int region_count = 0;               // Счетчик фактически прочитанных регионов

    // Открываем файл для чтения (предполагается, что файл называется "data.txt")
    file = fopen("data.txt", "r");
    if (file == NULL) {                 // Проверяем, успешно ли открылся файл
        printf("Ошибка открытия файла data.txt\n");  // Выводим сообщение об ошибке
        return 1;                       // Завершаем программу с кодом ошибки
    }

    printf("Читаем данные из файла...\n");  // Информируем пользователя о процессе

    // Читаем данные из файла построчно
    while (region_count < MAX_REGIONS && fscanf(file, "%s %d",
           regions[region_count].region, &regions[region_count].culture_count) == 2) {

        // Читаем культуры для текущего региона
        for (int i = 0; i < regions[region_count].culture_count; i++) {
            fscanf(file, "%s %f %f",
                   regions[region_count].cultures[i].name,
                   &regions[region_count].cultures[i].yield,
                   &regions[region_count].cultures[i].area);
        }
        region_count++;                 // Увеличиваем счетчик регионов
    }

    fclose(file);                       // Закрываем файл после чтения

    printf("Отсортировано регионов: %d\n", region_count);   // Выводим количество регионов

    // Сортируем массив регионов по возрастанию общего объема урожая с помощью пузырька
    bubble_sort(regions, region_count);

    // Выводим регионы с суммарной площадью менее 5000 га
    printf("\nРегионы с площадью засева менее 5000 га (отсортировано по урожаю):\n");
    printf("---------------------------------------------------------------\n");

    for (int i = 0; i < region_count; i++) {    // Проходим по всем отсортированным регионам
        float total_area = get_total_area(&regions[i]); // Вычисляем суммарную площадь
        float total_yield = get_total_yield(&regions[i]); // Вычисляем суммарный урожай

        // Проверяем условие: площадь менее 5000 га
        if (total_area < 5000.0) {
            printf("Регион: %-20s Площадь: %.1f га Урожай: %.0f т\n",
                   regions[i].region, total_area, total_yield); // Выводим информацию
        }
    }

    return 0;                               // Завершаем программу успешно
}

//Пример содержания файла
//Алтайский_край 3
//пшеница 45000 2800
//картофель 12000 900
//подсолнечник 18000 1200
//Краснодарский_край 2
//рис 32000 4100
//кукуруза 55000 3800
//Новосибирская_область 4
//пшеница 28000 2200
//ячмень 15000 1100
//овес 8000 600
//горох 5000 400
//Ростовская_область 2
//пшеница 38000 2900
//подсолнечник 25000 2100
//Ставропольский_край 3
//пшеница 42000 3100
//ячмень 18000 1400
//кукуруза 22000 1600
//Воронежская_область 2
//пшеница 35000 2600
//сахарная_свекла 28000 1900
//Орловская_область 3
//рожь 12000 850
//пшеница 24000 1800
//картофель 9000 700
//Курская_область 2
//пшеница 31000 2400
//рожь 11000 800
